function WbDispatcher(){var t={};function e(e){return t[e]||(t[e]=new Flux.Dispatcher),t[e]}this.on=function(t,r){return e(t).register(r)},this.off=function(t,r){return e(t).unregister(r)},this.waitFor=function(t,r){return e(t).waitFor(r)},this.dispatch=function(t,r){return e(t).dispatch(r)},this.isDispatching=function(t){return e(t).isDispatching()}}!function(t,e){"use strict";"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():t.ResizeObserver=e()}(this,function(){"use strict";var t=function(){if("undefined"!=typeof Map)return Map;function t(t,e){var r=-1;return t.some(function(t,n){return t[0]===e&&(r=n,!0)}),r}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(e){var r=t(this.__entries__,e),n=this.__entries__[r];return n&&n[1]},e.prototype.set=function(e,r){var n=t(this.__entries__,e);~n?this.__entries__[n][1]=r:this.__entries__.push([e,r])},e.prototype.delete=function(e){var r=this.__entries__,n=t(r,e);~n&&r.splice(n,1)},e.prototype.has=function(e){return!!~t(this.__entries__,e)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,e){void 0===e&&(e=null);for(var r=0,n=this.__entries__;r<n.length;r++){var i=n[r];t.call(e,i[1],i[0])}},e}()}(),e="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,r="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),n="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(r):function(t){return setTimeout(function(){return t(Date.now())},1e3/60)},i=2;var o=20,s=["top","right","bottom","left","width","height","size","weight"],a="undefined"!=typeof MutationObserver,l=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(t,e){var r=!1,o=!1,s=0;function a(){r&&(r=!1,t()),o&&u()}function l(){n(a)}function u(){var t=Date.now();if(r){if(t-s<i)return;o=!0}else r=!0,o=!1,setTimeout(l,e);s=t}return u}(this.refresh.bind(this),o)}return t.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},t.prototype.removeObserver=function(t){var e=this.observers_,r=e.indexOf(t);~r&&e.splice(r,1),!e.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},t.prototype.updateObservers_=function(){var t=this.observers_.filter(function(t){return t.gatherActive(),t.hasActive()});return t.forEach(function(t){return t.broadcastActive()}),t.length>0},t.prototype.connect_=function(){e&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),a?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){e&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(t){var e=t.propertyName,r=void 0===e?"":e;s.some(function(t){return!!~r.indexOf(t)})&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),u=function(t,e){for(var r=0,n=Object.keys(e);r<n.length;r++){var i=n[r];Object.defineProperty(t,i,{value:e[i],enumerable:!1,writable:!1,configurable:!0})}return t},c=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||r},d=m(0,0,0,0);function h(t){return parseFloat(t)||0}function p(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return e.reduce(function(e,r){return e+h(t["border-"+r+"-width"])},0)}function f(t){var e=t.clientWidth,r=t.clientHeight;if(!e&&!r)return d;var n=c(t).getComputedStyle(t),i=function(t){for(var e={},r=0,n=["top","right","bottom","left"];r<n.length;r++){var i=n[r],o=t["padding-"+i];e[i]=h(o)}return e}(n),o=i.left+i.right,s=i.top+i.bottom,a=h(n.width),l=h(n.height);if("border-box"===n.boxSizing&&(Math.round(a+o)!==e&&(a-=p(n,"left","right")+o),Math.round(l+s)!==r&&(l-=p(n,"top","bottom")+s)),!function(t){return t===c(t).document.documentElement}(t)){var u=Math.round(a+o)-e,f=Math.round(l+s)-r;1!==Math.abs(u)&&(a-=u),1!==Math.abs(f)&&(l-=f)}return m(i.left,i.top,a,l)}var y="undefined"!=typeof SVGGraphicsElement?function(t){return t instanceof c(t).SVGGraphicsElement}:function(t){return t instanceof c(t).SVGElement&&"function"==typeof t.getBBox};function g(t){return e?y(t)?function(t){var e=t.getBBox();return m(0,0,e.width,e.height)}(t):f(t):d}function m(t,e,r,n){return{x:t,y:e,width:r,height:n}}var v=function(){function t(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=m(0,0,0,0),this.target=t}return t.prototype.isActive=function(){var t=g(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},t}(),b=function(){return function(t,e){var r,n,i,o,s,a,l,c=(n=(r=e).x,i=r.y,o=r.width,s=r.height,a="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,l=Object.create(a.prototype),u(l,{x:n,y:i,width:o,height:s,top:i,right:n+o,bottom:s+i,left:n}),l);u(this,{target:t,contentRect:c})}}(),_=function(){function e(e,r,n){if(this.activeObservations_=[],this.observations_=new t,"function"!=typeof e)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=r,this.callbackCtx_=n}return e.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof c(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new v(t)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof c(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(e){e.isActive()&&t.activeObservations_.push(e)})},e.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map(function(t){return new b(t.target,t.broadcastRect())});this.callback_.call(t,e,t),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),w="undefined"!=typeof WeakMap?new WeakMap:new t,P=function(){return function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var r=l.getInstance(),n=new _(e,r,this);w.set(this,n)}}();return["observe","unobserve","disconnect"].forEach(function(t){P.prototype[t]=function(){var e;return(e=w.get(this))[t].apply(e,arguments)}}),void 0!==r.ResizeObserver?r.ResizeObserver:P}),angular.module("am-wb-core",[]),angular.module("am-wb-core").factory("WidgetEditor",function(){function t(t,e){this.callbacks=[],this.widget=t,this.options=e}return t.prototype.destroy=function(){this.callbacks=[],delete this.widget,delete this.options},t.prototype.getWidget=function(){return this.widget},t.prototype.setDirty=function(t){this.dirty=void 0===t||t},t.prototype.isDirty=function(){return this.dirty},t.prototype.off=function(t,e){if(angular.isArray(this.callbacks[t])){var r=this.callbacks[t],n=r.indexOf(e);n>-1&&r.splice(n,1)}},t.prototype.on=function(t,e){angular.isArray(this.callbacks[t])||(this.callbacks[t]=[]),_.includes(this.callbacks[t],e)||this.callbacks[t].push(e)},t.prototype.fire=function(t,e){for(var r=_.merge({source:this,type:t},e||{}),n=this.callbacks[t]||[],i=0;i<n.length;i++)try{n[i](r)}catch(t){}},t.prototype.setActive=function(){},t.prototype.isActive=function(){},t.prototype.save=function(){},t.prototype.hide=function(){},t.prototype.show=function(){},t.prototype.isHidden=function(){},t}),angular.module("am-wb-core").factory("WbObservableObject",function(){function t(){this.silent=!1,this.callbacks={}}return t.prototype.setSilent=function(t){this.silent=t},t.prototype.isSilent=function(){return this.silent},t.prototype.on=function(t,e){if(!angular.isFunction(e))throw{message:"Callback must be a function"};var r=this.callbacks;angular.isArray(r[t])||(r[t]=[]),r[t].includes(e)||r[t].push(e)},t.prototype.off=function(t,e){var r=this.callbacks;if(angular.isArray(r[t])){var n=r[t].indexOf(e);n>-1&&r[t].splice(n,1)}},t.prototype.fire=function(t,e){var r=_.merge({source:this,type:t},e||{}),n=this.callbacks;if(!this.isSilent()&&angular.isDefined(n[t]))for(var i=n[t],o=0;o<i.length;o++)try{i[o].apply(i[o],[r])}catch(t){log.error({source:"ObservableObject",message:"The listener throw an unexpected exception.",exception:t})}},t}),angular.module("am-wb-core").factory("$wbMedia",["$rootScope","$window",function(t,e){var r={xs:"(max-width: 599px)","gt-xs":"(min-width: 600px)",sm:"(min-width: 600px) and (max-width: 959px)","gt-sm":"(min-width: 960px)",md:"(min-width: 960px) and (max-width: 1279px)","gt-md":"(min-width: 1280px)",lg:"(min-width: 1280px) and (max-width: 1919px)","gt-lg":"(min-width: 1920px)",xl:"(min-width: 1920px)",landscape:"(orientation: landscape)",portrait:"(orientation: portrait)",print:"print"},n=["xl","gt-lg","lg","gt-md","md","gt-sm","sm","gt-xs","xs","landscape","portrait","print"],i={},o={},s={},a={};return l.getResponsiveAttribute=function(t,e){for(var r=0;r<n.length;r++){var s=n[r];if(o[i[s]].matches){var a=c(t,e+"-"+s);if(t[a])return t[a]}}return t[c(t,e)]},l.getQuery=function(t){return o[t]},l.watchResponsiveAttributes=function(t,e,n){var i=[];return t.forEach(function(t){var o=c(e,t);for(var s in angular.isDefined(e[o])&&i.push(e.$observe(o,angular.bind(void 0,n,null))),r)o=c(e,t+"-"+s),angular.isDefined(e[o])&&i.push(e.$observe(o,angular.bind(void 0,n,s)))}),function(){i.forEach(function(t){t()})}},l;function l(t){var n=i[t];angular.isUndefined(n)&&(n=i[t]=function(t){return r[t]||("("!==t.charAt(0)?"("+t+")":t)}(t));var a=s[n];return angular.isUndefined(a)&&(a=function(t){var r=o[t];r||(r=o[t]=e.matchMedia(t));return r.addListener(u),s[r.media]=!!r.matches}(n)),a}function u(e){t.$evalAsync(function(){s[e.media]=!!e.matches})}function c(t,e){return a[e]||(a[e]=t.$normalize(e))}}]),angular.module("am-wb-core").factory("WbProcessorAbstract",["WbObservableObject",function(t){function e(){t.apply(this,arguments)}return e.prototype=new t,e}]),angular.module("am-wb-core").factory("WbProcessorAttribute",["WbProcessorAbstract",function(t){function e(t,e){var r=t.getElement(),n={},i=t.getModelProperty("style")||{},o=t.getRuntimeModel()||{};e?_.forEach(e,function(t){n[t]=o.style[t]||i[t]||""}):(r.attr("style",""),n=angular.merge({},i,o.style)),r.css(n)}function r(t,e,r){(!t.isEditable()||"draggable"!==e&&"dropzone"!==e)&&"style"!==e&&"type"!==e&&"version"!==e&&"on"!==e&&"children"!==e&&"template"!==e&&("html"===e?t.html(r||""):"text"===e?("style"===t.getType()&&t.setElementAttribute("type","text/css"),t.text(r||"")):"value"===e?t.val(r||""):"inputType"===e||"aType"===e||"scriptType"===e?t.setElementAttribute("type",r):t.setElementAttribute(e,r))}function n(t,e){if(_.isUndefined(e)){var n=t.getModelProperty();_.forEach(n,function(e,n){r(t,n,e)})}else _.forEach(e,function(e){r(t,e,t.getProperty(e)||t.getModelProperty(e))})}function i(){t.apply(this)}return i.prototype=new t,i.prototype.process=function(t,r){if("stateChanged"===r.type&&"ready"===r.value)n(t),e(t);else if("modelUpdated"===r.type){for(var i=r.keys||[r.key],o=[],s=[],a=0;a<i.length;a++)i[a].startsWith("style.")?o.push(i[a].substring(6)):s.push(i[a]);n(t,s),e(t,o)}},i}]),angular.module("am-wb-core").factory("WbProcessorEvent",["WbProcessorAbstract","$widget","$injector",function(t,e,r){function n(t,n,i){var o;if(!t.eventFunctions.hasOwnProperty(n))try{var s=t.getEvent()[n];if(!s)return;s+="\n//@ sourceURL=wb-"+t.getId()+"-"+n+".js";var a=_.join(_.concat(["$widget","$event"],e.getProvidersKey()));t.eventFunctions[n]=new Function(a,s)}catch(t){}if(o=t.eventFunctions[n])try{var l=_.merge({$event:i,$widget:t},e.getProviders());return r.invoke(o,t,l)}catch(t){}}function i(){t.apply(this)}return i.prototype=new t,i.prototype.process=function(t,r){if("stateChanged"===r.type)if("ready"===t.state){!function(t){t.__eventListeners={click:function(e){return n(t,"click",e)},dblclick:function(e){return n(t,"dblclick",e)},mouseout:function(e){return n(t,"mouseout",e)},mouseover:function(e){return n(t,"mouseover",e)},mousedown:function(e){return n(t,"mousedown",e)},mouseup:function(e){return n(t,"mouseup",e)},mouseenter:function(e){return n(t,"mouseenter",e)},mouseleave:function(e){return n(t,"mouseleave",e)},resize:function(e){return n(t,"resize",e)},intersection:function(e){return n(t,"intersection",e)},success:function(e){return n(t,"success",e)},error:function(e){return n(t,"error",e)},abort:function(e){return n(t,"abort",e)},load:function(e){return n(t,"load",e)},beforeunload:function(e){return n(t,"beforeunload",e)},unload:function(e){return n(t,"unload",e)},change:function(e){return n(t,"change",e)},input:function(e){return n(t,"input",e)},keyup:function(e){return n(t,"keyup",e)},keydown:function(e){return n(t,"keydown",e)},keypress:function(e){return n(t,"keypress",e)}},angular.forEach(t.__eventListeners,function(e,r){t.on(r,e)})}(t),n(t,"stateChanged",r);var i=_.clone(r);i.type="init",n(t,i.type,i)}else!function(t){angular.isDefined(t.__eventListeners)&&(angular.forEach(t.__eventListeners,function(e,r){t.off(r,e)}),delete t.__eventListeners),_.forEach(e.getProviders(),function(t){_.isFunction(t.clean)&&t.clean()})}(t)},i}]),angular.module("am-wb-core").factory("WbProcessorMicrodata",["WbProcessorAbstract",function(t){var e=["itemscope","itemtype","itemprop","itemref","itemid","content","value"];function r(t,e){var r=t.getElement();angular.forEach(e,function(e){var n=t.getProperty(e)||t.getModelProperty(e);n?r.attr(e,n):r.removeAttr(e)})}function n(){t.apply(this)}return n.prototype=new t,n.prototype.process=function(t,n){"modelChanged"!==n.type&&"stateChanged"!==n.type?"modelUpdated"!==n.type||r(t,_.intersection(e,n.keys||[n.key])):r(t,e)},n}]),angular.module("am-wb-core").run(["$window","$q","$rootScope",function(t,e,r){var n={},i={};t.loadLibrary=function(t){if(n[t])return e.resolve({message:"isload"});var i=e.defer(),o=document.createElement("script");return o.src=t,o.async=1,o.onload=function(){n[t]=!0,i.resolve({path:t,message:"loaded"}),r.$$phase||r.$digest()},o.onerror=function(){n[t]=!1,i.reject({path:t,message:"fail"}),r.$$phase||r.$digest()},document.getElementsByTagName("head")[0].appendChild(o),i.promise},t.removeLibrary=function(t){return e.resolve({source:t})},t.isLibraryLoaded=function(t){return!!n[t]},t.loadStyle=function(t){if(i[t])return e.resolve(i[t]);var n=e.defer(),o=document.createElement("link");return o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href",t),o.onload=function(){i[t]={element:o,path:t},n.resolve(i[t]),r.$$phase||r.$digest()},o.onerror=function(){i[t]=void 0,n.reject({path:t,message:"fail"}),r.$$phase||r.$digest()},document.getElementsByTagName("head")[0].appendChild(o),i[t]=n.promise,i[t]},t.removeStyle=function(t){if(!this.isStyleLoaded(t))return e.resolve({});var r=i[t];r.element.parentNode.removeChild(r.element),i[t]=void 0,e.resolve(r)},t.isStyleLoaded=function(t){return!!i[t]},t.setMeta=function(t,e){var r,n=t.replace(new RegExp(":","g"),"\\:"),i=$("head"),o=i.find('meta[name="'+n+'"]');_.isUndefined(e)?o.length&&o.remove():(0===o.length?(r=angular.element("<meta name='"+t+"' content='' />"),i.append(r)):r=angular.element(o[0]),r.attr("content",e))},t.getMeta=function(t){var e=t.replace(new RegExp(":","g"),"\\:"),r=$("head").find('meta[name="'+e+'"]');if(0!==r.length)return r.attr("content")},t.setLink=function(t,e){var r,n=t.replace(new RegExp(":","g"),"\\:"),i=$("head"),o=i.find("link[key="+n+"]");for(var s in 0===o.length?(r=angular.element("<link key='"+t+"' />"),i.append(r)):r=angular.element(o[0]),e)r.attr(s,e[s])}}]),angular.module("am-wb-core").run(["$widget","WbProcessorMicrodata","WbProcessorEvent","WbProcessorAttribute",function(t,e,r,n){t.setProcessor("microdata",new e),t.setProcessor("event",new r),t.setProcessor("attribut",new n)}]),angular.module("am-wb-core").run(["$anchorScroll","$animate","$cacheFactory","$document","$exceptionHandler","$filter","$http","$httpParamSerializer","$httpParamSerializerJQLike","$interpolate","$interval","$locale","$location","$log","$parse","$q","$rootElement","$sce","$templateCache","$templateRequest","$timeout","$window","$widget","$wbMedia","$wbStorage","$wbDispatcher",function(t,e,r,n,i,o,s,a,l,u,c,d,h,p,f,y,g,m,v,b,_,w,P,E,$,x){P.setProvider("$anchorScroll",t).setProvider("$animate",e).setProvider("$cacheFactory",r).setProvider("$document",n).setProvider("$exceptionHandler",i).setProvider("$filter",o).setProvider("$http",s).setProvider("$httpParamSerializer",a).setProvider("$httpParamSerializerJQLike",l).setProvider("$interpolate",u).setProvider("$interval",c).setProvider("$locale",d).setProvider("$location",h).setProvider("$log",p).setProvider("$parse",f).setProvider("$q",y).setProvider("$rootElement",g).setProvider("$sce",m).setProvider("$templateCache",v).setProvider("$templateRequest",b).setProvider("$timeout",_).setProvider("$window",w).setProvider("$dispatcher",x).setProvider("$storage",$).setProvider("$media",E)}]),angular.module("am-wb-core").run(["$widget",function(t){t.newWidget({type:"ObjectCollection",template:"<div></div>",controller:"AmWbSeenCollectionWidget"}),t.newWidget({type:"import",template:"<div></div>",controller:"WbWidgetSeenImport"})}]),angular.module("am-wb-core").service("$dispatcher",WbDispatcher).service("$wbDispatcher",WbDispatcher),angular.module("am-wb-core").service("$objectPath",function(){var t=Object.prototype.hasOwnProperty,e={};function r(t){var e=parseInt(t);return e.toString()===t?e:t}function n(t,r){if(e.includeInheritedProps||"number"==typeof r&&_.isArray(t)||t.hasOwnProperty(r))return t[r]}function i(t,e,o,s){if("number"==typeof e&&(e=[e]),!e||0===e.length)return t;if("string"==typeof e)return i(t,e.split(".").map(r),o,s);var a=e[0],l=n(t,a);return 1===e.length?(void 0!==l&&s||(t[a]=o),l):(void 0===l&&("number"==typeof e[1]?t[a]=[]:t[a]={}),i(t[a],e.slice(1),o,s))}this.has=function(n,i){if(null==n)return!1;if("number"==typeof i?i=[i]:"string"==typeof i&&(i=i.split(".")),!i||0===i.length)return!1;for(var o=0;o<i.length;o++){var s=r(i[o]);if(!("number"==typeof s&&_.isArray(n)&&s<n.length||(e.includeInheritedProps?s in Object(n):t.call(n,s))))return!1;n=n[s]}return!0},this.ensureExists=function(t,e,r){return i(t,e,r,!0)},this.set=function(t,e,r,n){return i(t,e,r,n)},this.insert=function(t,e,r,n){var i=this.get(t,e);n=~~n,_.isArray(i)||(i=[],this.set(t,e,i)),i.splice(n,0,r)},this.empty=function(e,r){var n,i;if(!_.isEmpty(r)&&(null!=e&&(n=this.get(e,r)))){if("string"==typeof n)return this.set(e,r,"");if(_.isBoolean(n))return this.set(e,r,!1);if("number"==typeof n)return this.set(e,r,0);if(_.isArray(n))n.length=0;else{if(!_.isObject(n))return this.set(e,r,null);for(i in n)t.call(n,i)&&delete n[i]}}},this.push=function(t,e){var r=this.get(t,e);_.isArray(r)||(r=[],this.set(t,e,r)),r.push.apply(r,Array.prototype.slice.call(arguments,2))},this.coalesce=function(t,e,r){for(var n,i=0,o=e.length;i<o;i++)if(void 0!==(n=this.get(t,e[i])))return n;return r},this.get=function(t,e,i){if("number"==typeof e&&(e=[e]),!e||0===e.length)return t;if(null==t)return i;if("string"==typeof e)return this.get(t,e.split("."),i);var o=r(e[0]),s=n(t,o);return void 0===s?i:1===e.length?s:this.get(t[o],e.slice(1),i)},this.del=function(t,e){if("number"==typeof e&&(e=[e]),null==t)return t;if(_.isEmpty(e))return t;if("string"==typeof e)return this.del(t,e.split("."));var i=r(e[0]),o=n(t,i);if(null==o)return o;if(1===e.length)_.isArray(t)?t.splice(i,1):delete t[i];else if(void 0!==t[i])return this.del(t[i],e.slice(1));return t}}),angular.module("am-wb-core").service("$wbStorage",function(){}),angular.module("am-wb-core").service("$wbUtil",["$q","$templateRequest","$sce",function(t,e,r){function n(t){var n=t.template,i=t.templateUrl;return angular.isDefined(n)?angular.isFunction(n)&&(n=n(t.params||t)):angular.isDefined(i)&&(angular.isFunction(i)&&(i=i(t.params)),angular.isDefined(i)&&(t.loadedTemplateUrl=r.valueOf(i),n=e(i))),n}function i(t){angular.isObject(t.style)||(t.style={}),function(t){if(t.style.layout)t.style.layout.align_self&&(t.style.alignSelf=t.style.layout.align_self),t.style.layout.direction&&(t.style.display="flex",t.style.flexGrow=t.style.layout.grow,t.style.flexShrink=t.style.layout.shrink,t.style.flexBasis=t.style.layout.basis,t.style.flexDirection=t.style.layout.direction,t.style.flexWrap=t.style.layout.wrap?"wrap":"no-wrap",t.style.justifyContent=t.style.layout.justify,"end"!==t.style.justifyContent&&"end"!==t.style.justifyContent||(t.style.justifyContent="flex-"+t.style.justifyContent),t.style.alignItems=t.style.layout.align,t.style.order=t.style.layout.order),delete t.style.layout}(t),function(t){t.style.size&&(t.style.width=t.style.size.width,t.style.minWidth=t.style.size.minWidth,t.style.maxWidth=t.style.size.maxWidth,t.style.height=t.style.size.height,t.style.minHeight=t.style.size.minHeight,t.style.maxHeight=t.style.size.maxHeight,delete t.style.size)}(t),function(t){if(t.style.background)t.style.background.image&&(t.style.backgroundImage='url("'+t.style.background.image+'")'),t.style.backgroundColor=t.style.background.color,t.style.backgroundSize=t.style.background.size,t.style.backgroundRepeat=t.style.background.repeat,t.style.backgroundOrigin=t.style.background.origin,t.style.backgroundPosition=t.style.background.position,delete t.style.background}(t),function(t){if(t.style.border)t.style.borderStyle=t.style.border.style,t.style.borderColor=t.style.border.color,t.style.borderWidth=t.style.border.width,t.style.borderRadius=t.style.border.radius,delete t.style.border}(t),function(t){if(t.style.padding&&angular.isObject(t.style.padding)){var e="";e=t.style.padding.isUniform?t.style.padding.uniform:t.style.padding.top||"0px "+t.style.padding.right||"0px "+t.style.padding.bottom||"0px "+t.style.padding.left||"0px ",t.style.padding=e}if(t.style.margin&&angular.isObject(t.style.margin)){var r="";r=t.style.margin.isUniform?t.style.margin.uniform:t.style.margin.top||"0px "+t.style.margin.right||"0px "+t.style.margin.bottom||"0px "+t.style.margin.left||"0px ",t.style.margin=r}}(t),function(t){t.style.overflow&&(t.style.overflowX=t.style.overflow.x,t.style.overflowY=t.style.overflow.y)}(t),function(t){if(t.style.shadows){var e=[];_.forEach(t.style.shadows,function(t){var r=t.hShift+" "+t.vShift+" "+t.blur+" "+t.spread+" "+t.color;t.inset&&(r+=" inset"),e.push(r)}),t.style.boxShadow=_.join(e),delete t.style.shadows}}(t)}function o(t){return delete t.version,function(t){t.on?delete t.event:(t.event||(t.event={}),t.event.failure&&(t.event.error=t.event.failure,delete t.event.failure),t.event&&(t.on=t.event,delete t.event),t.on&&_.forOwn(t.on,function(e,r){t.on[r]="/* code style is deprecated. see http://www.viraweb123.ir/amh-blog/content/wb-v4-release */ \n"+e}))}(t),i(t),_.isArray(t.contents)&&(t.children=t.contents,delete t.contents),_.isArray(t.children)&&t.children.length&&_.forEach(t.children,o),function(t){"Group"===t.type&&(t.type="div"),"Import"===t.type&&(t.type="import"),"Link"===t.type&&(t.type="a",t.html=t.title,t.href=t.url,t.style.text={align:"center"},t.style.cursor="pointer",delete t.title,delete t.url),"Image"===t.type&&(t.type="img",t.src=t.url,delete t.url),"HtmlText"===t.type&&(t.html=t.text,delete t.text)}(t),t}this.clean=function(t,e){if(t.type&&"Page"!==t.type&&"Group"!==t.type||(t.type="div"),"wb4"===t.version&&!e)return t;var r=o(t);return r.version="wb4",r},this.getTemplateFor=function(e){return t.when(n(e))},this.getTemplateOf=n,this.findWidgetModelById=function(t,e){if(t.id===e)return t;if(_.isArray(t.children))for(var r=0;r<t.children.length;r++){var n=this.findWidgetModelById(t.children[r],e);if(n)return n}return null},this.replaceWidgetModelById=function(t,e,r){if(!t||t.id==e)return r;if(_.isArray(t.children)){for(var n=0;n<t.children.length;n++)if(t.children[n].id===e)return t.children[n]=r,t;for(n=0;n<t.children.length;n++){if(this.replaceWidgetModelById(t.children[n],e,r))return t}}},this.downloadWidgetModel=function(t,r){var n=this;return e(t).then(function(t){var e=n.clean(angular.fromJson(t));return r?n.findWidgetModelById(e,r):e})}}]),angular.module("am-wb-core").service("$widget",["$q","$injector","$log","WidgetEditor",function(t,e,r,n){var i=[],o=this,s=[],a=[],l={},u={},c=[],d={template:'<div ng-show="wbEditable">Unsuported widget?!</div>',label:"Not found",description:"Element not found"};function h(t){for(var e=0;e<i.length;e++)if(i[e].id===t)return i[e];var r={id:t};return i.push(r),r}function p(t){var e=_.isString(t)?t:t.type;return l[e]||d}function f(t){return!_.isUndefined(l[t])}this.hasWidget=f,o.newWidget=function(t){return f(t.type)&&r.warn("Widget is replaced",t),t.model=t.model||{style:{}},t.model.type=t.type,t.model.name=t.model.name||t.title,l[t.type]=t,o},o.widget=function(e){return t.when(p(e))},o.widgets=function(){var e={items:[]};return _.forEach(l,function(t){e.items.push(t)}),t.when(e)},o.widgetData=function(t){return angular.copy(t.model)},o.getWidget=p,o.getWidgets=function(){var t={items:[]};return a.forEach(function(e){t.items.push(s[e])}),t},o.group=h,o.groups=function(){return i},o.newGroup=function(t){var e=h(t.id);angular.extend(e,t)},o.compile=function(r,n,i){var o,s=p(r);o=i||angular.element("<"+r.type+"></"+r.type+">");var a=new(e.get(s.controller||"WbWidgetElement"))(o,n);return o[0].$$wbController=a,t.resolve(a.setModel(r))},this.getChildren=function(t){var e=[],r=[];for(_.forEach(t.getChildren(),function(t){r.push(t)});r.length;){t=r.pop(),e.push(t);for(var n=t.getChildren(),i=0;i<n.length;i++){var o=n[i];r.push(o)}}return e};var y={};this.removeProvider=function(t){var e=y[t];return y[t]=void 0,e},this.getProvider=function(t){return y[t]},this.setProvider=function(t,e){return y[t]=e,this},this.getProviders=function(){return y},this.addProvider=function(t,e){return this.setProvider(t,e)},this.getProvidersKey=function(){return _.keys(y)};var g={},m=new n;this.setEditor=function(t,e){g[t]=e},this.getEditor=function(t){if(t.$$wbEditor)return t.$$wbEditor;if(void 0===g[t.getType()])return m;var r=g[t.getType()],n=new(e.get(r.type))(t,r.options||{}),i=this;return t.$$wbEditor=n,n.on("destroy",function(){i.removeEditorFromList(n)}),n},this.setProcessor=function(t,e){u[t]=e},this.removeProcessor=function(t){u[t]=void 0},this.getProcessor=function(t){return u[t]},this.getProcessors=function(){return u},this.applyProcessors=function(t,e){e=e||{},angular.forEach(u,function(n){try{n.process(t,e)}catch(t){r.error({message:"Fail to run the processor",exception:t})}})},this.addConverter=function(t){c.push(t)},this.getConverters=function(){return c},this.getConverter=function(t){for(var e=0;e<c.length;e++)if(c[e].getMimetype()===t)return c[e]},this.widgetFromPoint=function(t,e){return this.widgetFromElement(document.elementFromPoint(t,e))},this.widgetFromElement=function(t){if(t)do{if(t.$$wbController)return t.$$wbController;t=t.parentNode}while(t)}}]),angular.module("am-wb-core").factory("WbWidget",["$widget","$window","$objectPath","$log",function(t,e,r,n){function i(t,e){this.elementAttributes=["id","name","title","class","accesskey","contenteditable","hidden","tabindex","dir","lang","translate","spellcheck","draggable","dropzone"],this.$element=t,this.$parent=e,this.state,this.actions=[],this.callbacks=[],this.childWidgets=[],this.eventFunctions={},this.computedStyle={},this.runtimeModel={style:{},on:{}},this.model={};var r,n,i,o=this;this.eventListeners={scroll:function(t){o.fire("scroll",t)},click:function(t){o.fire("click",t)},dblclick:function(t){o.fire("dblclick",t)},mouseout:function(t){o.fire("mouseout",t)},mouseover:function(t){o.fire("mouseover",t)},mousedown:function(t){o.fire("mousedown",t)},mouseup:function(t){o.fire("mouseup",t)},mouseenter:function(t){o.fire("mouseenter",t)},mouseleave:function(t){o.fire("mouseleave",t)},error:function(t){o.fire("error",t)},success:function(t){o.fire("success",t)},load:function(t){o.fire("load",t)},dragstart:function(t){o.fire("dragstart",t)},dragend:function(t){o.fire("dragend",t)},dragenter:function(t){o.fire("dragenter",t)},dragover:function(t){o.fire("dragover",t)},dragleave:function(t){o.fire("dragleave",t)},drop:function(t){o.fire("drop",t)},change:function(t){o.fire("change",t)},input:function(t){o.fire("input",t)},keyup:function(t){o.fire("keyup",t)},keydown:function(t){o.fire("keydown",t)},keypress:function(t){o.fire("keypress",t)}},this.resizeObserver=new ResizeObserver((r=function(t){angular.isArray(t)&&(t=t[0]),o.fire("resize",t)},n=300,function(){var t=this,e=arguments;clearTimeout(i),i=setTimeout(function(){i=null,r.apply(t,e)},n)}));this.intersectionObserver=new IntersectionObserver(function(t){_.isArray(t)&&(t=t[0]),o.setIntersecting(t.isIntersecting,t)},{root:null,rootMargin:"0px",threshold:[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1]}),this.connect()}return i.prototype.getModel=function(){return this.model},i.prototype.setModel=function(t){if(t!==this.model)return this.setState("init"),this.model=t,this.runtimeModel={style:{},on:{}},this.fire("modelChanged"),this.setState("ready"),this},i.prototype.hasModelProperty=function(t){return r.has(this.getModel(),t)},i.prototype.getModelProperty=function(t){return r.get(this.getModel(),t)},i.prototype.setModelProperty=function(t,e){var n={source:this,key:t,keys:[t],oldValue:this.getModelProperty(t),value:e};angular.equals(n.oldValue,n.value)||(e?r.set(this.getModel(),t,e):r.del(this.getModel(),t),this.fire("modelUpdated",n))},i.prototype.getRuntimeModel=function(){return this.runtimeModel},i.prototype.hasProperty=function(t){return r.has(this.getRuntimeModel(),t)},i.prototype.getProperty=function(t){return r.get(this.getRuntimeModel(),t)},i.prototype.removeProperty=function(t){var e=this.getRuntimeModel();r.del(e,t)},i.prototype.setProperty=function(t,e){switch(t){case"style.layout.direction":t="style.flexDirection";break;case"style.background.color":t="style.backgroundColor";break;case"style.size.width":t="style.width";break;case"style.size.height":t="style.height"}var n={source:this,key:t,keys:[t],oldValue:this.getProperty(t),value:e};if(!angular.equals(n.oldValue,n.value)){var i=this.getRuntimeModel();angular.isDefined(e)?r.set(i,t,e):r.del(i,t),this.fire("modelUpdated",n)}},i.prototype.style=function(t,e){return angular.isDefined(t)?angular.isString(t)?angular.isDefined(e)?this.setStyle(t,e):this.getStyle(t):void 0:angular.copy(this.getProperty("style"))},i.prototype.setStyle=function(t,e){this.setProperty("style."+t,e)},i.prototype.getStyle=function(t){return this.getProperty("style."+t)},i.prototype.delete=function(){this.fire("delete"),this.getParent().removeChild(this)},i.prototype.destroy=function(t){(this.fire("destroy",t),this.callbacks=[],this.actions=[],this.model=null,angular.forEach(this.childWidgets,function(t){t.destroy()}),this.childWidgets=[],this.isRoot())||this.getElement().remove()},i.prototype.disconnect=function(){var t=this.getElement();t&&(this.resizeObserver.unobserve(t[0]),this.intersectionObserver.unobserve(t[0]),angular.forEach(this.eventListeners,function(e,r){t.off(r,e)}))},i.prototype.connect=function(){var t=this.getElement();t&&(angular.forEach(this.eventListeners,function(e,r){t.on(r,e)}),this.resizeObserver.observe(t[0]),this.intersectionObserver.observe(t[0]))},i.prototype.getElement=function(){return this.$element},i.prototype.setElementAttribute=function(t,e){var r=this.$element;e?r.attr(t,e):r.removeAttr(t)},i.prototype.getElementAttribute=function(t){return this.$element.attr(t)},i.prototype.removeElementAttribute=function(t){this.$element.removeAttr(t)},i.prototype.setSilent=function(t){this.silent=t},i.prototype.isSilent=function(){return this.silent},i.prototype.on=function(t,e){if(!angular.isFunction(e))throw{message:"Callback must be a function"};angular.isArray(this.callbacks[t])||(this.callbacks[t]=[]),this.callbacks[t].includes(e)||this.callbacks[t].push(e)},i.prototype.off=function(t,e){if(angular.isArray(this.callbacks[t])){var r=this.callbacks[t],n=r.indexOf(e);n>-1&&r.splice(n,1)}},i.prototype.fire=function(e,r){var i=(r=r||{})||{};if(i.source=this,i.type=e,t.applyProcessors(this,i),!this.isSilent()&&angular.isDefined(this.callbacks[e])){for(var o=this.callbacks[e],s=null,a=0;a<o.length;a++)try{s=o[a](i)||s}catch(t){n.log(t)}return s}},i.prototype.getDirection=function(){return this.getModelProperty("style.flexDirection")||"column"},i.prototype.getEvent=function(){return this.getModelProperty("on")||{}},i.prototype.getTitle=function(){return this.getModelProperty("label")},i.prototype.getType=function(){return this.getModelProperty("type")},i.prototype.getId=function(){return this.getModelProperty("id")},i.prototype.getName=function(){return this.getModelProperty("name")},i.prototype.getParent=function(){return this.$parent},i.prototype.setState=function(t){if(t!==this.state){var e=this.state;this.state=t,this.fire("stateChanged",{oldValue:e,value:t})}},i.prototype.getState=function(){return this.state},i.prototype.isEditable=function(){return this.editable},i.prototype.setEditable=function(t){this.editable!==t&&(this.editable=t,t?this.setState("edit"):this.setState("ready"),angular.forEach(this.childWidgets,function(e){e.setEditable(t)}))},i.prototype.isIntersecting=function(){return this.intersecting},i.prototype.setIntersecting=function(t,e){_.isUndefined(this.intersecting)&&(t=!0),this.intersecting=t,this.fire("intersection",e)},i.prototype.clone=function(){var t=this.getParent(),e=t.indexOfChild(this);t.addChild(e,angular.copy(this.getModel()))},i.prototype.moveNext=function(){var t=this.getParent();t.moveChild(this,t.indexOfChild(this)+1)},i.prototype.moveBefore=function(){var t=this.getParent();t.moveChild(this,t.indexOfChild(this)-1)},i.prototype.moveFirst=function(){this.getParent().moveChild(this,0)},i.prototype.moveLast=function(){var t=this.getParent();t.moveChild(this,t.getChildren().length-1)},i.prototype.isRoot=function(){var t=this.getParent();return angular.isUndefined(t)||null===t},i.prototype.getRoot=function(){if(this.rootWidget)return this.rootWidget;for(this.rootWidget=this;!this.rootWidget.isRoot();)this.rootWidget=this.rootWidget.getParent();return this.rootWidget},i.prototype.isSelected=function(){return this.selected},i.prototype.setSelected=function(t){this.selected!==t&&(this.selected=t,t?this.fire("select"):this.fire("unselect"))},i.prototype.addAction=function(t){this.actions.push(t)},i.prototype.getActions=function(){return this.actions},i.prototype.getBoundingClientRect=function(){var t=this.getElement();if(!t)return{width:0,height:0,top:0,left:0};var e=t.offset();return{width:t.outerWidth(),height:t.outerHeight(),top:e.top+t.scrollTop(),left:e.left+t.scrollLeft()}},i.prototype.animate=function(t){var e={targets:this.getRuntimeModel()};t.duration&&(e.duration=t.duration),t.loop&&(e.loop=t.loop),t.autoplay&&(e.autoplay=t.autoplay),t.delay&&(e.delay=t.delay),t.easing&&(e.easing=t.easing);var r=this,n=[];for(var i in t){if(!_.includes(["duration","loop","autoplay","delay","easing"],i))n.push(i),e[i]=t[i],this.getProperty(i)||this.setProperty(i,this.getModelProperty(i))}return e.update=function(){r.fire("modelUpdated",{keys:n,value:null,oldValue:null})},anime(e)},i.prototype.removeAnimation=function(){},i.prototype.setWindow=function(t){this.window=t},i.prototype.getWindow=function(){return this.window||this.getRoot().getWindow()||e},i.prototype.addElementAttributes=function(){this.elementAttributes=_.union(this.elementAttributes,arguments)},i.prototype.getElementAttributes=function(){return this.elementAttributes},i}]),angular.module("am-wb-core").factory("WbWidgetContainer",["$wbUtil","$widget","$q","WbWidget",function(t,e,r,n){function i(t,e){n.apply(this,[t,e])}return i.$inject=["$element","$parent"],i.prototype=Object.create(n.prototype),i.prototype.setModel=function(t){if(t!==this.model){this.setState("init"),this.model=t,this.fire("modelChanged");var e=this;return this.loadWidgets().then(function(){return e})}},i.prototype.delete=function(){this.removeChildren(),this.fire("delete"),this.isRoot()||this.getParent().removeChild(this)},i.prototype.getChildById=function(t){for(var e=this.childWidgets,r=0;r<e.length;r++)if(e[r].getId()===t)return e[r]},i.prototype.getChildren=function(){return this.childWidgets},i.prototype.removeChild=function(t){var e=this.indexOfChild(t);if(e>-1){this.childWidgets.splice(e,1);var r=this.getModel();return e=r.children.indexOf(t.getModel()),r.children.splice(e,1),t.destroy(),!0}return!1},i.prototype.removeChildren=function(){var t=_.clone(this.getChildren());_.forEach(t,function(t){t.delete()})},i.prototype.loadWidgets=function(){angular.forEach(this.childWidgets,function(t){t.destroy()}),this.childWidgets=[];var t=this,e=function(){t.fire("loaded"),t.setState("ready")};if(!this.model||!angular.isArray(this.model.children))return r.resolve().finally(e);var n=this;return this.__compileChildren(this.model.children).then(function(e){n.childWidgets=e;var r=n.getElement();r.empty(),_.forEach(n.childWidgets,function(e){e.setEditable(t.isEditable()),r.append(e.getElement())})}).finally(e)},i.prototype.addChildModel=function(t,e){var r=[e];return this.addChildrenModel(t,r)},i.prototype.addChildrenModel=function(t,e){var r=this.getModel(),n=this;return t=this.__cleanInsertIndex(t),this.__compileChildren(e).then(function(e){for(var i=0;i<e.length;i++){var o=e[i],s=i+t;s<n.childWidgets.length?o.getElement().insertBefore(n.childWidgets[s].getElement()):n.getElement().append(o.getElement()),angular.isArray(r.children)||(r.children=[]),r.children.splice(s,0,o.getModel()),n.childWidgets.splice(s,0,o),o.setEditable(n.isEditable())}n.fire("newchild",{widgets:e})})},i.prototype.addChild=i.prototype.addChildModel,i.prototype.addChildren=i.prototype.addChildrenModel,i.prototype.__compileChildren=function(n){var i=[],o=[],s=this;return angular.forEach(n,function(r,n){r=t.clean(r),i.push(e.compile(r,s).then(function(t){o[n]=t}))}),r.all(i).then(function(){return o})},i.prototype.__cleanInsertIndex=function(t){return!angular.isDefined(t)||t>this.childWidgets.length?this.childWidgets.length:t<0?0:t},i.prototype.moveChild=function(t,e){function r(t,e,r){var n=t[e];t.splice(e,1),t.splice(r,0,n)}if(!(e<0||e>this.getChildren().length-1||1===this.getChildren().length)&&this.getModel().children.indexOf(t.getModel())!==e){var n=this.getChildren()[e];this.getModel().children.indexOf(t.getModel())<e?n.getElement().after(t.getElement()):n.getElement().before(t.getElement()),r(this.getModel().children,this.getModel().children.indexOf(t.getModel()),e),r(this.getChildren(),this.indexOfChild(t),e)}},i.prototype.indexOfChild=function(t){return this.childWidgets&&this.childWidgets.length?this.childWidgets.indexOf(t):-1},i}]),angular.module("am-wb-core").factory("WbWidgetElement",["WbWidgetContainer",function(t){function e(e,r){t.apply(this,[e,r]);var n=this;function i(t){switch(t.key){case"text":n.getElement().text(n.getProperty(t.key)||n.getModelProperty(t.key));break;case"html":n.getElement().html(n.getProperty(t.key)||n.getModelProperty(t.key));break;case"intpuType":case"aType":n.setElementAttribute("type",t.value)}}this.on("modelUpdated",i),this.on("runtimeModelUpdated",i)}return e.prototype=Object.create(t.prototype),e.prototype.html=function(){var t=arguments[0];t&&this.setModelProperty("html",t);var e=this.getElement();return e.html.apply(e,arguments)},e.prototype.text=function(){var t=arguments[0];t&&this.setModelProperty("text",t);var e=this.getElement();return e.text.apply(e,arguments)},e.prototype.val=function(){var t=arguments[0];t&&this.setModelProperty("value",t);var e=this.getElement();return e.val.apply(e,arguments)},e.prototype.attr=function(){var t=this.getElement();return t.attr.apply(t,arguments)},e.prototype.removeAttr=function(){var t=this.getElement();return t.removeAttr.apply(t,arguments)},e.prototype.prop=function(){var t=this.getElement();return t.prop.apply(t,arguments)},e.prototype.removeProp=function(){var t=this.getElement();return t.removeProp.apply(t,arguments)},e.prototype.empty=function(){var t=this.getElement();return this.removeChildren(),t.empty(),this},e.prototype.parent=function(){return this.getParent()},e}]),angular.module("am-wb-core").factory("AmWbSeenCollectionWidget",["WbWidgetElement","$wbUtil","$q","$http","$log",function(t,e,r,n,i){function o(){this.param={},this.filterMap={},this.sortMap={}}o.prototype._init_filters=function(){var t=this.filterMap,e=Object.keys(t);this.param["_px_fk[]"]=[],this.param["_px_fv[]"]=[];for(var r=0;r<e.length;r++)for(var n=e[r],i=t[n],o=0;o<i.length;o++){var s=i[o];this.param["_px_fk[]"].push(n),this.param["_px_fv[]"].push(s)}},o.prototype._init_sorts=function(){var t=this.sortMap;this.param["_px_sk[]"]=Object.keys(t),this.param["_px_so[]"]=[];for(var e=0;e<this.param["_px_sk[]"].length;e++){var r=this.param["_px_sk[]"][e];this.param["_px_so[]"][e]=t[r]}},o.prototype.setSize=function(t){return this.param._px_ps=t,this},o.prototype.setQuery=function(t){return this.param._px_q=t,this},o.prototype.setPage=function(t){return this.param._px_p=t,this},o.prototype.nextPage=function(){return this.param._px_p||(this.param._px_p=1),this.param._px_p+=1,this},o.prototype.setOrder=function(t,e){return e?this.addSorter(t,e):this.removeSorter(t,e),this._init_sorts(),this},o.prototype.addSorter=function(t,e){return e?(this.sortMap[t]=e,this._init_sorts(),this):this},o.prototype.removeSorter=function(t){return delete this.sortMap[t],this._init_sorts(),this},o.prototype.clearSorters=function(){this.sortMap={}},o.prototype.setFilter=function(t,e){return angular.isDefined(e)?(this.filterMap[t]=[],this.addFilter(t,e)):this.removeFilter(t,e),this._init_filters(),this},o.prototype.addFilter=function(t,e){return angular.isDefined(e)?(angular.isArray(this.filterMap[t])||(this.filterMap[t]=[]),this.filterMap[t].push(e),this._init_filters(),this):this},o.prototype.removeFilter=function(t){return delete this.filterMap[t],this._init_filters(),this},o.prototype.clearFilters=function(){this.filterMap={}},o.prototype.getParameter=function(){return this.param},o.prototype.put=function(t,e){return this.param[t]=e,this},o.prototype.get=function(t){return this.param[t]};var s="ideal",a=["url","filters","sorts","query","properties"],l=["template"];function u(t,n){var o,s=[],a="";if(!angular.isArray(t))return r.resolve([]);for(var l=0;l<t.length;l++){a=n;try{o=Mustache.to_html(a,t[l]),o=JSON.parse(o),o=e.clean(o),s.push(o)}catch(t){i.error({message:"Falie to load template",error:t});continue}}return r.resolve(s)}function c(e,r,n){t.apply(this,[e,r,n]),this._lastResponse,this._state=s;var i=this;function o(t){_.includes(l,t.key)&&i.reloadView(),_.includes(a,t.key)&&i.reloadPage()}i.on("modelUpdated",o),i.on("runtimeModelUpdated",o),this.on("loaded",function(){i.reloadPage()})}return c.prototype=Object.create(t.prototype),c.prototype.reloadPage=function(){var t=this;if(this._reloading)return this._reloading.finally(function(){return t.reloadPage()});this.empty(),this._allLoadedData=[],delete this._lastResponse,this._reloading=this.loadNextPage(!0).finally(function(){delete t._reloading})},c.prototype.reloadView=function(){var t=this;return u(t._allLoadedData||[],t.getTemplate()).then(function(e){return t.addChildren(0,e)})},c.prototype.loadNextPage=function(){if(!this.hasMorePage())return r.reject({message:"No more page!?"});var t=this;return this.getCollection().then(function(e){return t._lastResponse=e.data,t._allLoadedData=_.union(t._allLoadedData||[],e.data.items),t.fire("success",e)||e.data},function(e){return t.fire("error",e)||e}).then(function(e){return u(e.items||[],t.getTemplate())}).then(function(e){return t.addChildren(t.getChildren().length,e).then(function(){return t.fire("load",{children:e})||e})})},c.prototype.getTemplate=function(){return this.getProperty("template")||this.getModelProperty("template")||{type:"HtmlText",text:"<h3>Template is not set</h3>"}},c.prototype.getCollection=function(){if(this._state!==s)return this.lastQuery;var t=new o,e=this.getProperty("filters")||this.getModelProperty("filters")||[];angular.forEach(e,function(e){t.addFilter(e.key,e.value)});var i=this.getProperty("sorts")||this.getModelProperty("sorts")||[];angular.forEach(i,function(e){t.addSorter(e.key,e.order)}),t.setQuery(this.getProperty("query")||this.getModelProperty("query")),t.put("graphql",this.getProperty("properties")||this.getModelProperty("properties"));var a=this.getProperty("url")||this.getModelProperty("url");if(a){var l=this.getNextPageIndex();l>1&&t.setPage(l),this._state="busy";var u=this;this._lastQuery=n({method:"GET",url:a,params:t.getParameter()}).finally(function(){u._state=s,delete u.lastQuery})}else this._lastQuery=r.reject({message:"URL is not set",code:1});return this._lastQuery},c.prototype.getPagesCount=function(){return this._lastResponse?this._lastResponse.page_number:0},c.prototype.getCurrentPage=function(){return this._lastResponse?this._lastResponse.current_page:0},c.prototype.getItemPerPage=function(){return this._lastResponse?this._lastResponse.items_per_page:0},c.prototype.hasMorePage=function(){return!this._lastResponse||this._lastResponse.current_page<this._lastResponse.page_number},c.prototype.getNextPageIndex=function(){return this._lastResponse?this._lastResponse.current_page+1:1},c.prototype.getState=function(){return this._state||s},c}]),angular.module("am-wb-core").factory("WbWidgetSeenImport",["WbWidgetContainer","$wbUtil","$q",function(t,e,r){"use strict";function n(e,r,n){t.apply(this,[e,r,n]),this.setAllowedTypes(),this.addElementAttributes("url");var i=this;function o(t){"url"===t.key&&i.reload()}this.on("modelUpdated",o),this.on("runtimeModelUpdated",o),this.on("modelChanged",function(){i.reload()})}return n.prototype=Object.create(t.prototype),n.prototype.reload=function(){var t=this;t.removeChildren(),t.getModel().children=[];var n,i=this.getProperty("url")||this.getModelProperty("url")||"";return(i=i.trim())?(this.paths=i.split(","),n=function(t){var n=[],i=Array(t.length);function o(){return _.remove(i,function(t){return!_.isUndefined(t)})}return _.forEach(t,function(t,r){var o=t.split("#"),s=o[0],a=o.length>1?o[1]:void 0,l=e.downloadWidgetModel(s,a).then(function(t){i[r]=t});n.push(l)}),r.all(n).then(o,o)}(this.paths).then(function(e){return t.fire("success",{children:e})||e})):n=r.resolve([]),n.then(function(e){return t.addChildrenModel(0,e).finally(function(){t.fire("load",{children:e})})})},n.prototype.setAllowedTypes=function(){this.allowedTypes=[]},n.prototype.setEditable=function(e){t.prototype.setEditable.apply(this,arguments);for(var r=this.getChildren();!_.isEmpty(r);){var n=r.pop();n.setSilent(e),r=r.concat(n.getChildren())}},n}]);
//# sourceMappingURL=am-wb-core.map